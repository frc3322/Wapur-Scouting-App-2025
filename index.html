<!-- 
Documentation is very important for this project

For all of the interactive elements, here is their ID and what they do:

AUTON:
mobility - mobility
ballsShotOver - MCQ of how many balls were shot over
cratesPushed - The number of the crates pushed over the line in auto 

TELEOP: // Deleted L1-L4







bucketsSucceeded // These three haven't been added into the QR code yet.
bucketsFailed
methodOfBuckets - MCQ
breakdown - the breakdown

MATCH INFORMATION:
teamNumber - The team number
scouterName - The scouter's name
matchNubmer - The match number

increaseL1Button - Button to increase L1 button

MISC:
submit - The submit button



Todo:
Put the whole form into a form tag, and make it so that it clears when you submit the form.
-->
<!DOCTYPE html>
<html lang="en">

<head>
  <link href="https://fonts.googleapis.com/css2?family=Barlow:wght@100;200;300;400;500;600;700;800;900&display=swap"
    rel="stylesheet">

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>3322 Wapur 2025 Scouting</title>
  <link rel="stylesheet" href="stylesheet.css">

</head>

<body>
  <div class="section">
    <h1>3322 Wapur 2025 Scouting</h1>
  </div>
  <br>
  <div class="section">
    <h2>Auton:</h2>
    <label for="mobility">Mobility:</label>
    <br>
    <input type="checkbox" id="mobility"><br>
    <br>

    <label for="ballsShotOver">How many balls were shot over?:</label>
    <br>
    <select name="ballsShotOver" id="ballsShotOver">
      <option value=4>All shot over</option>
      <option value=3>More than half shot over</option>
      <option value=2>Half shot over</option>
      <option value=1>Less than half shot over</option>
      <option value=0>None shot over</option>
    </select>
    <br>
    <br>
    <label for="cratesPushed">How many crates were pushed over the line?:</label>
    <br>
    <input type="number" id="cratesPushed" placeholder="Crates">
  </div>
  <br>
  <div class="section">
    <h2>Teleop</h2>

    <!-- L4 -->
    <div class="buttons">
      <div id="l4-button-success" class="successButton">
        <button onclick="updateCrateData(4, 1, 1)" id="L4SuccessButton" class="incButton">L4 Success: </br>&lt 0 &gt</button>
        <button onclick="updateCrateData(4, 1, -1)" class="decButton">-1</button>
      </div>
      <div id="l4-button-failure" class="failureButton">
        <button onclick="updateCrateData(4, 0, 1)" id="L4FailureButton" class="incButton">L4 Failure: </br>&lt 0 &gt</button>
        <button onclick="updateCrateData(4, 0, -1)" class="decButton">-1</button>
      </div>
    </div>

    <!-- L3 -->
    <div class="buttons">
      <div id="l3-button-success" class="successButton">
        <button onclick="updateCrateData(3, 1, 1)" id="L3SuccessButton" class="incButton">L3 Success: </br>&lt 0 &gt</button>
        <button onclick="updateCrateData(3, 1, -1)" class="decButton">-1</button>
      </div>
      <div id="l3-button-failure" class="failureButton">
        <button onclick="updateCrateData(3, 0, 1)" id="L3FailureButton" class="incButton">L3 Failure: </br>&lt 0 &gt</button>
        <button onclick="updateCrateData(3, 0, -1)" class="decButton">-1</button>
      </div>
    </div>

    <!-- L2 -->
    <div class="buttons">
      <div id="l2-button-success" class="successButton">
        <button onclick="updateCrateData(2, 1, 1)" id="L2SuccessButton" class="incButton">L2 Success: </br>&lt 0 &gt</button>
        <button onclick="updateCrateData(2, 1, -1)" class="decButton">-1</button>
      </div>
      <div id="l2-button-failure" class="failureButton">
        <button onclick="updateCrateData(2, 0, 1)" id="L2FailureButton" class="incButton">L2 Failure: </br>&lt 0 &gt</button>
        <button onclick="updateCrateData(2, 0, -1)" class="decButton">-1</button>
      </div>
    </div>

    <!-- L1 -->
    <div class="buttons">
      <div id="l1-button-success" class="successButton">
        <button onclick="updateCrateData(1, 1, 1)" id="L1SuccessButton" class="incButton">L1 Success: </br>&lt 0 &gt</button>
        <button onclick="updateCrateData(1, 1, -1)" class="decButton">-1</button>
      </div>
      <div id="l1-button-failure" class="failureButton">
        <button onclick="updateCrateData(1, 0, 1)" id="L1FailureButton" class="incButton">L1 Failure: </br>&lt 0 &gt</button>
        <button onclick="updateCrateData(1, 0, -1)" class="decButton">-1</button>
      </div>
    </div>


    <h3>Buckets:</h3>
    <br>
    <div class="buttons">
      <div id="l5-button-success" class="successButton">
        <button onclick="updateCrateData(5, 1, 1)" id="L5SuccessButton" class="incButton">Bucket Success: </br>&lt 0 &gt</button>
        <button onclick="updateCrateData(5, 1, -1)" class="decButton">-1</button>
      </div>
      <div id="l5-button-failure" class="failureButton">
        <button onclick="updateCrateData(5, 0, 1)" id="L5FailureButton" class="incButton">Bucket Failure: </br>&lt 0 &gt</button>
        <button onclick="updateCrateData(5, 0, -1)" class="decButton">-1</button>
      </div>

    </div>



  <br>

  <div class="section">
    <h2>Match info:</h2>
    <select  id="teamNumber">
  <option value=830>830 - Jeff</option>
  <option value=1076>1076 - Gary</option>
  <option value=3322>3322 - Eve</option>
  <option value=5066>5066 - John </option>
  <option value=5067>5067 - Tobot</option>
  <option value=5708>5708 - Eli</option>
  <option value=6101>6101 - Clanka</option>
  <option value=7660>7660 - Perry</option>
  <option value=10656>10656 - WallE</option>
</select>
    <input type="text" id="scouterName" placeholder="Scouter Name">
    <input type="number" id="matchNumber" placeholder="Match Number">
    <br><br>
    <label for="breakdown">Breakdown:</label>
    <br>
    <button id="breakdown">0.00</button>
    <br><br>
    <button type="button" id="submit">Submit!</button>
    <div id="qrcode"></div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <script>

    let breakdownTotal = 0;
    let breakdownInterval;
    let isBroken = false;
    let starting = 0;


    const dataList = [
      "teamNumber,scouterName,matchNumber,mobility,ballsShotOver,Crates Pushed,L1S,L1F,L2S,L2F,L3S,L3F,L4S,L4F"]

    //l1 success, l1 fail, l2 success, l2 fail, l3 success, l3 fail, l4 success, l4 fail
    const crateData = [["L1 Success: ",
      "L1 Failure: ",
      "L2 Success: ",
      "L2 Failure: ",
      "L3 Success: ",
      "L3 Failure: ",
      "L4 Success: ",
      "L4 Failure: ", 
      "Bucket Success",
      "Bucket Failure"],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [document.getElementById("L1SuccessButton").textContent,
    document.getElementById("L1FailureButton").textContent,
    document.getElementById("L2SuccessButton").textContent,
    document.getElementById("L2FailureButton").textContent,
    document.getElementById("L3SuccessButton").textContent,
    document.getElementById("L3FailureButton").textContent,
    document.getElementById("L4SuccessButton").textContent,
    document.getElementById("L4FailureButton").textContent]]



    function breakdownToggle() {
      if (isBroken == false) {
        starting = Date.now(); // Use global variable
        isBroken = true;
        document.getElementById("breakdown").style.backgroundColor = "yellow";


        breakdownInterval = setInterval(() => {
          document.getElementById("breakdown").textContent = (((Date.now() - starting)+ breakdownTotal) / 1000 ).toFixed(2);
        }, 100);
      }
      else {
        document.getElementById("breakdown").style.backgroundColor = "LightGray";
        isBroken = false;
        //alert(Date.now() - starting);
        clearInterval(breakdownInterval);
        let elapsed = ((Date.now() - starting));
        breakdownTotal += elapsed;
        document.getElementById("breakdown").textContent = (breakdownTotal/1000).toFixed(2);



      }
      //let starting = (now.getMinutes() + "." + now.getSeconds() + now.getMilliseconds()); 

    }

    function submit() {
      // Gather all data

      //datalist.push(document.getElementById("matchNumber").value + "");
      data = document.getElementById("teamNumber").value + "," +
        document.getElementById("scouterName").value + "," +
        document.getElementById("matchNumber").value + "," +
        (document.getElementById("mobility").checked ? "1" : "0") + "," +
        document.getElementById("ballsShotOver").value + "," +
        document.getElementById("cratesPushed").value + "," +
        crateData[1][0] + "," +
        crateData[1][1] + "," +
        crateData[1][2] + "," +
        crateData[1][3] + "," +
        crateData[1][4] + "," +
        crateData[1][5] + "," +
        crateData[1][6] + "," +
        crateData[1][7] + "," +
        crateData[1][8] + "," +
        crateData[1][9] + "," +
        + breakdownTotal;


      dataList.push(data);


      document.getElementById("qrcode").innerHTML = "";

      // Generate QR code linking to the CSV data URL
      new QRCode(document.getElementById("qrcode"), {
        text: data,   // this is the file download link encoded in the QR
        width: 200,
        height: 200
      });

      window.location.href = "qrcode.html" + "?data=" + data;
    }

    function updateCrateData(level, success, change) {
      const index = (level * 2 - 1) - success;
      crateData[1][index] += change;

      const levelString = "L" + level;
      const successString = (success == 1) ? "Success" : "Failure";

      document.getElementById(levelString + successString + "Button").textContent = crateData[0][index] + "\n < " + crateData[1][index] + " >";

    }

    document.getElementById("submit").addEventListener("click", submit);
    document.getElementById("breakdown").addEventListener("click", breakdownToggle);
  </script>
</body>

</html>
